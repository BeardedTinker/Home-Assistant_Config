#####
# Nuki Alternative integration
# https://gist.github.com/alexdelprete/296f50a4e5b35c0ea4bbed99a7420f5e
#####

platform: template
sensors:
   nuki_door_sensor_state:
    unique_id: nuki_door_sensor_state
    device_class: door
    friendly_name: "Nuki Door Sensor State"
    icon_template: >
      {% set door_icon = states('input_number.nuki_bridge_door_sensor_state') | int %}
      {% set lock_icon = states('input_number.nuki_bridge_lock_sensor_state') | int %}
      {% if door_icon == 2 and lock_icon == 3 %}
        mdi:door-closed
      {% elif door_icon == 2 and lock_icon == 1 %}
        mdi:door-closed-lock
      {% elif door_icon == 3 %}
        mdi:door-open
      {% endif %}
    value_template: >
      {{ states('input_number.nuki_bridge_door_sensor_state') | int == 3 }}
    attribute_templates:
      trigger_id: >
        {{ states('input_text.nuki_bridge_trigger_id') if states('input_text.nuki_bridge_trigger_id') != 'unknown' }}
      bridge_callback_id_list: >
        {{ states('input_text.nuki_bridge_callback_list')|from_json if is_state('binary_sensor.nuki_bridge_callback', 'on') else states('input_text.nuki_bridge_callback_id_list_states') }}
      nuki_id: >
        {{ states('sensor.nuki_id') if states('sensor.nuki_id') != 'unknown' }}
      door_state_numeric: >
        {{ states('input_number.nuki_bridge_door_sensor_state') if states('input_number.nuki_bridge_door_sensor_state') != 'unknown' }}
      door_state: >
        {{ states('input_text.nuki_bridge_door_sensor') if states('input_text.nuki_bridge_door_sensor') != 'unknown' }}
      lock_state_numeric: >
        {{ states('input_number.nuki_bridge_lock_sensor_state') if states('input_number.nuki_bridge_lock_sensor_state') != 'unknown' }}
      lock_state: >
        {{ states('input_text.nuki_bridge_lock_sensor') if states('input_text.nuki_bridge_lock_sensor') != 'unknown' }}
      lock_battery: >
        {{ states('sensor.nuki_lock_battery_level') if states('sensor.nuki_lock_battery_level') != 'unknown' }}
      lock_battery_critical: >
        {{ states('binary_sensor.nuki_lock_battery_critical_state') if states('binary_sensor.nuki_lock_battery_critical_state') != 'unknown' }}
      keypad_battery_critical: >
        {{ states('binary_sensor.nuki_keypad_battery_critical_state') if states('binary_sensor.nuki_keypad_battery_critical_state') != 'unknown' else "n/a" }}
      last_activity_callback: >
        {{ states('input_text.nuki_bridge_last_activity') if states('input_text.nuki_bridge_last_activity') != 'unknown' }}
      last_activity_polled: >
        {{ states('sensor.nuki_last_activity') if states('sensor.nuki_last_activity') != 'unknown' }}
