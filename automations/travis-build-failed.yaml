#####
# Travis runson every Github commit
# If it fails, notify!
#####

alias: Travis build failed
id: 2043b650-bc2d-42ac-b037-59ef1348418d
description: 'Triggered when Travis-CI failes'
trigger:
- entity_id: sensor.beardedtinker_home_assistant_config_last_build_state
  platform: state
  to: errored
condition: []
action:
- service: script.notify_engine
  data_template:
    who: 'telegram'
    title: "Travis failed!"
    value1: "At {{ states('sensor.beardedtinker_home_assistant_config_last_build_finished_at') }} after {{states('sensor.beardedtinker_home_assistant_config_last_build_duration')}} seconds, while building {{ states('sensor.beardedtinker_home_assistant_config_last_build_id') }} "
    tag_id: 'warning'
# Disabled since notify_engine has beed introduced  
#- data:
#    title: Travis failed!
#    message: At {{ states('sensor.beardedtinker_home_assistant_config_last_build_finished_at') }} after {{states('sensor.beardedtinker_home_assistant_config_last_build_duration')}} seconds, while building {{ states('sensor.beardedtinker_home_assistant_config_last_build_id') }} 
#  service: notify.ebroz_bot
mode: single