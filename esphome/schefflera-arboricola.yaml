substitutions:
  devicename: schefflera-arboricola
  upper_devicename: Schefflera Arboricola

esphome:
  name: $devicename
  platform: ESP32
  board: esp32dev
  on_shutdown:
    then:
      - switch.turn_off: spower
      
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_key
  manual_ip:
    static_ip: 192.168.2.50
    gateway: 192.168.1.1
    subnet: 255.255.252.0
  fast_connect: enable
  
# Enable logging
logger:

# Enable Home Assistant API
api:
  password: !secret api_password

ota:
  password: !secret ota_password
  
switch:
  - platform: gpio
    pin: GPIO4
    name: "${upper_devicename} Sensor Power"
    id: spower
    restore_mode: ALWAYS_ON
    internal: true
    setup_priority: 1000

binary_sensor:
  - platform: gpio
    pin: 
      number: GPIO35
      mode: INPUT_PULLUP
      inverted: True
    name: "${upper_devicename} Wake Button"

i2c:
  sda: 25
  scl: 26
  scan: True
  id: bus_a
  setup_priority: -200

deep_sleep:
  run_duration: 30s
  sleep_duration: 60min

sensor:
  - platform: dht
    pin: 16
    model: dht11
    update_interval: 5sec
    temperature:
      name: "${upper_devicename} Temperature"
    humidity:
      name: "${upper_devicename} Humidity"
  - platform: adc
    pin: 32
    name: "${upper_devicename} Soil Moisture"
    attenuation: 11db
    unit_of_measurement: '%'
    update_interval: 5sec
    filters:
      # 1.48v = in water
      # 3.34v = dry
      lambda: |-
        return (3.3 - x) * 100.0 / (3.3 - 1.48);
#  - platform: adc
#    pin: 32
#    name: "${upper_devicename} Soil Moisture raw"
#    attenuation: 11db
#    unit_of_measurement: '%'
#    filters:
#      # 1.1v = in water
#      # 2.94v = dry
#      lambda: |-
#        return (2.95 - x) * 100.0 / (2.95 - 1.1);
  - platform: adc
    pin: 33
    name: "${upper_devicename} Battery"
    attenuation: 6db
    unit_of_measurement: 'V'
    update_interval: 5sec
    filters:
      - calibrate_linear:
          # Map 0.0 (from sensor) to 0.0 (true value)
          - 0.0 -> 0.0
          - 2.06 -> 1.89
      - lambda: return x * 2.0;
  - platform: adc
    pin: 33
    name: "${upper_devicename} Battery %"
    attenuation: 6db
    unit_of_measurement: '%'
    update_interval: 5sec
    filters:
#      - calibrate_linear:
#          # Map 0.0 (from sensor) to 0.0 (true value)
#          - 0.0 -> 0.0
#          - 2.06 -> 1.89       
      - lambda: |-
          return ((id(${devicename}_voltage).state -3.3) /0.8 * 100.00);  
  - platform: adc
    pin: GPIO34
    name: "${upper_devicename} Salt"
    update_interval: 5sec
    unit_of_measurement: '%'
    accuracy_decimals: 4
    filters:
      - calibrate_linear:
          # Map 0.0 (from sensor) to 0.0 (true value)
          - 0.0 -> 0.0
          - 1.1 -> 100.0
    
  - platform: bh1750
    i2c_id: bus_a
    name: "${upper_devicename} Illuminance"
    address: 0x23
    update_interval: 5sec
    setup_priority: -300